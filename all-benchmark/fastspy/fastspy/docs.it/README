/********************************************************************
 * FastSpy
 *
 * A Port Scanner under the GPL Licence
 * Home: [...]
 * Designed and implemented by Neural Revenge <neural@linuxfreak.com>
 *
 *******************************************************************/


DISCLAIMER
----------

In short,  authors are not  responsible of any damages  this software 
can cause.                                                            


OVERVIEW & FEATURES
-------------------

Fastspy e'  uno scanner parallelo di  porte TCP con alcune  feature a 
valore aggiunto :) Dato che rientra irrimediabilmente nella categoria 
dei "Yet Another Port Scanner" ho  deciso che la filosofia di base da 
seguire fosse la semplicita' e  la flessibilita'. Il principale scopo 
e' quello  di implementare funzionalita' semplici  ma utili, tentando 
di  ottenere dei  risultati in  modo rapido.  Spesso infatti  e' piu' 
utile  ottenere  una lista  di  "matches"  non completa  ma  ricavata 
in  breve  tempo  piuttosto  che averne  una  assolutamente  perfetta 
ottenenuta pero' in tempi  ecessivamente lunghi. Alcune funzionalita' 
includono la ricerca  di una porta attiva su  un'intera subnet (utile 
per la ricerca mirata dei servizi in un dominio); l'invio dei dati su 
una connessione  per loggare la  risposta ottenuta dal  server (utile 
per  registrate  informazioni  sensibili  come  versioni  software  e 
sistemi operativi usati); la scansione delle porte registrate tramite 
file  services attive  su un  indirizzo;  la scansione  di una  porta 
attiva su  una lista  di indirizzi  contenuta in  un file  (utile per 
l'interfacciamento  agli script).  Questo  programma  non ha  nessuna 
pretesa  di  essere  un  tool  potente  e  completo  ma,  per  quanto 
possibile, solo  efficace, veloce e  senza troppi fronzoli.  Tutto e' 
partito  come  un esercizio  di  programmazione,  poi continuando  ho 
aggiunto le opzioni che mi  servivano e che ritenevo interessanti, in 
modo da integrare  meglio le funzionalita' anche  con altri programmi 
(es.  client irc).  Sempre a  scopo  "didattico" e  di mia  personale 
utilita', ho iniziato il porting su Linux, "probe" non mi dava alcune 
funzionalita' che  mi servono  e "nmap"  sebbene rimanga  uno scanner 
eccellente, spesso risulta lento e pedante nella ricerca :P           



DESIGN OVERVIEW
---------------

Molto banalmente Fastspy  esegue una serie di  chiamate alla funzione 
connect()  utilizzando  il  target  specificato  usando  i  parametri 
ricevuti dall'utente.  Non utilizza nessuna tecnica  di mascheramento 
(modalita'   stealth)  in   quanto  alcune   opzioni  richiedono   il 
completamento della connesione  per il sucessivo transito  di dati in 
modo da  ricavare informazioni  interessanti per  il log.  Per questo 
e'  conveniente  sapere che  alcune  modalita'  di scansione  (quella 
dei  servizi attivi  (fast  scan) [-s]  per  esempio) possono  essere 
interpretate come  tentativi ostili  di tipo  "denial of  service" da 
parte del  target che riceve quasi  contemporaneamente un'enorme mole 
di  richieste  di connessioni  per  ogni  daemon attivo  nel  sistema 
(con  evidente  impatto  nell'utilizzo  delle  risorse  di  sistema). 
Il  funzionamento  e' diverso  dagli  scanner  sequenziali in  quanto 
esegue le  connessioni in  modalita' multithread.  In questo  modo si 
ottimizzano i  tempi morti presenti durante  l'attesa dell'esecuzione 
di ogni connect(), purtroppo per questo motivo (se si usano parametri 
troppo  stretti) si  possono  saturare molto  rapidamente le  risorse 
tcp-ip del sistema locale ed  incorrere nei cosiddetti "buffer error" 
delle socket  (ad onor del  vero visti  solo con win95),  che vengono 
comunque  conteggiati per  dare una  stima della  veridicita' di  una 
scansione. In passato  ho fatto un tentativo per  ovviare al problema 
creando un  algoritmo che si  adattasse automaticamente al  canale di 
rete ma la regolazione  delle tempistiche non risultava soddisfacente 
per le eccessive  perdite di tempo nel  bilanciamento retroattivo tra 
tempi  ed  errori. Quindi  si  lascia  il  tuning di  questa  opzione 
all'utente,  ad  ogni  modo  il valore  di  default  dovrebbe  andare 
/abbastanza/  bene.  In  definitiva  e'  consigliabile  non  eseguire 
scansioni specificando dei  delay eccessivamente piccoli, soprattutto 
se  si utilizzano  connessioni dial-up  che non  possono smaltire  il 
"rate"  impostato.  Come accennato  questo  scanner  si basa  su  una 
tecnica di scansione multi-thread  massiccia, viene generato un treno 
di  thread in  sequenza per  ogni porta/indirizzo  da scandire,  ogni 
thread  e' responsabile  della  rilevazione e  del  colloquio di  una 
determinata connessione. A run-time quindi  si crea una "finestra" di 
thread attivi  che si sposta man  mano verso la fine  del processo di 
scansione: i  thread piu' vecchi,  andando in timeout,  terminano uno 
dopo l'altro  contemporaneamente alla  generazione dei  nuovi thread. 
La  dimensione  di questa  finestra  indica  quindi la  quantita'  di 
risorse impiegata  nel sistema in termini  di numero di thread  ed e' 
proporzionale al  tempo di timeout di  connessione (-w) e al  rate di 
generazione dei  nuovi thread  (-d). Poiche' l'implementazione  di un 
port scanner  multi-thread presenta diverse problematiche  in termini 
di  impegno  di risorse  di  sistema  (inoltre  non tutti  i  sistemi 
operativi garantiscono un numero adeguato  di thread per processo) si 
consiglia  di non  impostare  i  valori di  -w  e  -d troppo  grandi. 
Probabilmente  in  una  futura  versione  aggiungero'  un'opzione  di 
forzatura del numero massimo  di thread da gestire contemporaneamente 
che in qualche modo agira' sulle  due opzioni -w e -d automaticamente 
adattandosi alla richiesta dell'utente.                               


Fastspy command line parameters
-------------------------------
fastspy 
   [-v][-s][-d <delay>]  [-w <timeout>]  [-f from_port -t  to_port l] 
   [-<address_list_file>] [-p <target_port> |  <service name>] [-r i] 
   [-<input_data_file>] [-o <output_txt_file>] 

-v : Attiva  la modalita' "verbose". Serve per vedere  il progress di 
attivita'  del programma  e per  testare i  delay impostati  [default 
disabilitata].                                                        

-d  : Delay  del  rate di  connessione [default  20  ms]. Con  questa 
opzione si puo' rallentare/velocizzare la scansione.                  

-w :  Waiting time.  Con questa opzione  e' possibile  specificare il 
tempo che il  programma usa per rimanere in attesa  di connessione su 
ogni porta  testata (si consiglia  di non settare questo  tempo oltre 
i  10  secondi  in  quanto  il  numero  di  thread  lanciati  dipende 
strettamente da  questa opzione e  da quella precedente).  [default 5 
sec]                                                                  

-s  :  Prova le  porte  registrate  (standard)  nel file  di  sistema 
"services"  (da rimpiazzare  opzionalmente  con  quello fornito).  Se 
questa opzione e' settata le opzioni -f, -t, verranno ignorate.       

-f : Numero di porta di partenza [default 1]

-t : Ultima porta da provare [default 500 in piu' della precedente].

-p : Forza la ricerca  di una determinata porta attiva sull'indirizzo 
di destinazione. L'indirizzo deve essere presente in formato numerico 
e  non come  nome, e'  possibile  specificare uno  o piu'  asterischi 
nell'host address come  maschera. Le opzioni [-f -t]  e [-s] verranno 
ignorate.                                                             

-r : Risolve gli indirizzi  degli host trovati (nel caso dell'opzione 
     -p) [default disattivata]                                             

-l : Specifica  un file di input contenente la  lista degli indirizzi 
da usare per la scansione. Il file deve essere di testo e deve essere 
presente un indirizzo (IP numerico  o nome dell'host) per ogni linea. 
Sono accettati  i commenti  se l'inizio della  linea comincia  con il 
carattere  '#'  o ';'  Per  usare  questa  scelta l'opzione  [-p]  e' 
richiesta e  in questo caso  verranno ignorate  le opzioni [-f  -t] e 
[-s]                                                                  

-i : Specifica  un file di input contenente i  dati che devono essere 
inviati sulla connessione quando si verifica. In questo caso l'output 
fornira' anche la risposta ottenuta dal server.                       

-o : Specifica un file di output dove loggare il risultato.

<host_name> : Host name del target.
<ip_address>: IP Host address del target.

REMARKS
-------

L'opzione  -l permette  di controllare  gli indirizzi  forniti in  un 
file  di testo  dall'utente, in  modo da  cercare il  servizio attivo 
effettuando delle scansioni mirate.  Nel caso si specifichi l'opzione 
-p (port  selection) e specificando  un indirizzo numerico a  riga di 
comando, si possono creare delle  maschere con piu' asterischi (anche 
in posizioni non  contigue) , non e'  comunque consigliabile superare 
un numero  massimo di due asterischi  (65536 combinazioni). L'opzione 
-r  rallenta la  visualizzazione degli  IP trovati  in quanto  accede 
al  DNS  per  risolvere  l'indirizzo. Poiche'  durante  la  scansione 
sono  in atto  un numero  variabile (solitamente  alto) di  richieste 
di  connessione verso  il  target questo  accesso potrebbe  risultare 
notevolmente rallentato, si  noti infatti che in alcuni  casi, fino a 
quando  non  termina  la  scansione, non  vengono  riportati  gli  IP 
trovati.                                                              


TESTED ENVIRONMENT
------------------
Fastspy Linux requirements:
- Linux >= 2.2.x
- Glibc >=  2.1.2 (RH  >=  6.1)  (fixa  molti problemi  sull'utilizzo 
massiccio di thread)                                                  

Fastspy Windows requirements:
- Windows 95 o Windows NT 3.5 e superiori.
- Standard Winsock 1.1 o superiore. Winsock 2.x consigliato. 

- Una linea Tcp/Ip attiva (eth or ppp) :)
  


Tested hosts:
Linux 2.2.12, Windows NT 4.0, Windows9x



EXAMPLES:
---------

FastSpy -f 6600 -t 6700 irc.stealth.net

 Riporta  tutte le  porte attive  nel range  6600-6700 sul  server IRC
irc.stealth.net

 L'output puo' essere una lista come questa:
Target address: 206.252.192.20

Scanning port 6600 to 6700 in progress...

 11:20:22  Service found at port no. 6661        Service: irc
 11:20:22  Service found at port no. 6660        Service: irc
 11:20:22  Service found at port no. 6662        Service: irc
 11:20:22  Service found at port no. 6663        Service: irc
 11:20:22  Service found at port no. 6664        Service: irc
 11:20:22  Service found at port no. 6666        Service: irc
 11:20:22  Service found at port no. 6667        Service: irc
 11:20:22  Service found at port no. 6669        Service: irc
 11:20:22  Service found at port no. 6665        Service: irc
 11:20:26  Service found at port no. 6668        Service: irc

10 occurence(s) have been found.

-------------
FastSpy -s ftp.funet.fi
 
 Riporta tutte le porte registrate ed attive sull'host ftp.funet.fi
 L'output puo' essere questo:
Target address: 128.214.248.6

Scanning all known service ports in progress...

 11:34:43  Service found at port no. 7           Service: echo
 11:34:44  Service found at port no. 17          Service: qotd
 11:34:44  Service found at port no. 21          Service: ftp
 11:34:44  Service found at port no. 23          Service: telnet
 11:34:44  Service found at port no. 25          Service: smtp
 11:34:44  Service found at port no. 53          Service: domain
 11:34:44  Service found at port no. 79          Service: finger
 11:34:44  Service found at port no. 80          Service: web
 11:34:44  Service found at port no. 109         Service: pop
 11:34:45  Service found at port no. 175         Service: vmnet
 11:34:45  Service found at port no. 513         Service: login
 11:34:45  Service found at port no. 515         Service: printer
 11:34:47  Service found at port no. 109         Service: pop
 11:34:47  Service found at port no. 110         Service: pop3
 11:34:47  Service found at port no. 111         Service: portmap
 11:34:48  Service found at port no. 514         Service: shell

17 occurence(s) have been found.

--------------
FastSpy -p web -r 194.243.154.*

 Riporta tutti  gli indirizzi nella  subnet 194.243.154.* in  cui sta 
 funzionando  il  servizio WEB  (porta  80).  Per ogni  indirizzo  IP 
 trovato  avviene  un "lookup"  per  visualizzare  il nome  del  sito 
 (opzione -r).  La scansione parte  da 194.243.154.0 e arriva  fino a 
 194.243.154.255 .                                                    

Looking for port: 80 [web] in 194.243.154.*

 11:35:44  Service web found at 194.243.154.19 [nibbler.cs.tin.it]
 11:35:44  Service web found at 194.243.154.21 [www.labiennale.it]
 11:35:44  Service web found at 194.243.154.32 [ns.tol.it]
 11:35:45  Service web found at 194.243.154.36 [fes1.tol.it]
 11:35:45  Service web found at 194.243.154.40 [www.olympiadi.it]
 11:35:45  Service web found at 194.243.154.44 [notes2.tol.it]
 11:35:46  Service web found at 194.243.154.54 [www.fnsi.it]
 11:35:46  Service web found at 194.243.154.57 [irc.tin.it]
 11:35:46  Service web found at 194.243.154.58 [multilab.tol.it]
 11:35:46  Service web found at 194.243.154.59 [golden.tin.it]
 11:35:44  Service web found at 194.243.154.13 [MUADDIB]
 11:35:44  Service web found at 194.243.154.23 [RIGEL]
 11:35:45  Service web found at 194.243.154.31 [NAC-3A]
 11:35:45  Service web found at 194.243.154.28 [NTMONITOR]
 11:35:46  Service web found at 194.243.154.47 [OPIT_MONDADORI]
 11:35:46  Service web found at 194.243.154.55 [GOLEM]
 11:35:52  Service web found at 194.243.154.248 [mercurio.tin.it]
 11:35:44  Service web found at 194.243.154.22 [unresolved]
 11:35:51  Service web found at 194.243.154.227 [goodmorning.tin.it]
 11:35:52  Service web found at 194.243.154.229 [PALINURO]
 11:35:46  Service web found at 194.243.154.48 [unresolved]
 11:35:46  Service web found at 194.243.154.73 [unresolved]
 11:35:51  Service web found at 194.243.154.228 [TO0B]
 11:35:45  Service web found at 194.243.154.45 [unresolved]
 11:35:52  Service web found at 194.243.154.230 [unresolved]
 11:35:52  Service web found at 194.243.154.231 [unresolved]
 11:35:52  Service web found at 194.243.154.235 [unresolved]
 11:35:52  Service web found at 194.243.154.233 [unresolved]
 11:35:52  Service web found at 194.243.154.242 [unresolved]
 11:35:51  Service web found at 194.243.154.226 [unresolved]

30 occurence(s) have been found.
Scanning complete, Bye.

-------------
FastSpy -p 6667 194.243.154.*

 Riporta tutti  gli indirizzi che corrispondono  sempre alla maschera 
 194.243.154.* in  cui e' in  funzione il servizio IRC  (porta 6667). 
 Non esegue il  lookup degli indirizzi IP  trovati. L'output potrebbe 
 essere questo:                                                       

Looking for port: 6667 [irc] in 194.243.154.*

 11:39:54  Service irc found at 194.243.154.32 [unresolved]
 11:39:54  Service irc found at 194.243.154.36 [unresolved]
 11:39:55  Service irc found at 194.243.154.57 [unresolved]
 11:39:56  Service irc found at 194.243.154.58 [unresolved]
 11:40:09  Service irc found at 194.243.154.226 [unresolved]

5 occurence(s) have been found.
Scanning complete, Bye.

----------
FastSpy -r -p web -i input.txt -o output.txt 195.10.*.1 

 Riporta tutte le porte web attive nel range 195.10.*.1 (195.10.0.1 ; 
 195.10.255.1)  trasmettendo  i  dati contenuti  nel  file  input.txt 
 e  salvando  l'output nel  file  output.txt.  Gli indirizzi  trovati 
 verranno  risolti  con  il  nome.  I dati  di  risposta  dei  server 
 contattati saranno delimitati dai tag: <Data Received> <End Data>    

Con un file input.txt come questo:

--- Begin Input.txt----
GET http://www.pino.com
-----------------------

Si puo' ottenere una risposta di questo tipo:
Looking for port: 80 [web] in 195.10.*.1

 11:43:15  Service web found at 195.10.1.1 [mexico.isp.fr]
 <Data Received>
HTTP/1.0 302 Objet déplacéLocation: http://195.10.1.1/Server: Microsoft-IIS/3.0Content-Type: 
text/htmlContent-Length: 174<head><title>Document d&eacute;plac&eacute;</title></head>
<body><h1>Objet déplacé</h1>Ce document peut &ecirc;tre trouv&eacute; <a 
HREF="http://195.10.1.1/">ici</a></body>


 <End Data>

 11:43:15  Service web found at 195.10.19.1 [fire.ebc.net]
 <Data Received>
<TITLE>Not Found</TITLE><H1>Not Found</H1> The requested object does not exist on this server. The 
link you followed is either outdated, inaccurate, or the server has been instructed not to let you have it. 
 <End Data>


 11:43:15  Service web found at 195.10.32.1 [as1.atsat.com]
 - No Data Received: Timeout -


 11:43:19  Service web found at 195.10.60.1 [unresolved]
 <Data Received>
<HTML><HEAD>
<TITLE>403 Forbidden</TITLE>
</HEAD><BODY>
<H1>Forbidden</H1>
You don't have permission
 <End Data>


4 occurence(s) have been found.
Scanning complete, Bye.

etc...


PERFORMANCE NOTE
----------------

Come si e' gia' accennato,  quando si effettuano scansioni prolungate 
o quando si impostano delay  eccessivamente piccoli si puo' incorrere 
in  errori di  uso delle  risorse,  in particolare  sui buffer  delle 
socket che si riempiono prima che  il canale fisico riesca a smistare 
i dati sulla  linea. Con Windows e' interessante notare  il fatto che 
queste "crisi" del sottosistema si verifichino piu' frequentemente (a 
parita' di delay impostati) quando si specificano scansioni di intere 
subnet  (piu'  indirizzi  IP  testati) e  non  quando  si  effettuano 
piu'  connessioni sullo  stesso  indirizzo (piu'  porte testate).  La 
spiegazione e' l'accesso  al protocollo ARP con  la conseguente query 
per  ogni nodo  IP  testato, potrebbe  essere interessante  sfruttare 
qualche  strada  *indiretta*  per  aggiornare prima  la  cache  della 
tabella arp e poi procedere con  la scansione e notare le differenze. 
Rimane fondamentale  pero' non introdurre codice  che limiti l'azione 
sulle reti  locali piuttosto  che sulle  connessioni dial-up  dove le 
problematiche di  scansione di indirizzi multipli  e' differente. 
Non si notano invece particolari degradazione dovute all'utilizzo del 
microprocessore in quanto l'implementazione con  i thread e le select 
e' notevolmente ottimizzata  dal kernel (idle mode),  infatti tutti i 
thread restano per la maggioranza del tempo in attesa di dati.                


DOWNLOAD
--------
[to be listed]

KNOWN BUGS
----------

- In caso di errori (typo)  la gestione delle opzioni e dei controlli 
della riga  di comando  e' piuttosto  fallace. Quando  si inseriscono 
alcune opzioni discordanti il  programma indipendentemente fa una sua 
scelta interpretando a modo suo i parametri :) soprattutto per quanto 
riguarda l'indirizzo o il nome (possibilmente) incompleto e scorretto 
fornito  dall'utente.  Anche  se  vengono stampati  i  parametri  che 
vengono  ottenuti  sarebbe  piu' elegante  uscire  fornendo  l'errore 
specifico (e magari il suggerimento).                                 

- Alle volte  capita di ottenere risultati  doppi (da investigare)... 
probabilmente  dovuta  al  parsing  scorretto delle  porte  del  file 
services (rilette sia quelle tcp  che udp) generando doppi tentativi. 
Dalla 2.1 non si verifica piu', dato per fixato.                      



BUG FIXES, SUGGESTIONS
----------------------

Please send  bug descriptions,  patches, suggestions, new  modules or 
successful stories to neural@linuxfreak.com                           


THANKS TO:
----------
Douglas  E.  Comer per  il  suo  ottimo libro:  "Internetworking  with
TCP/IP"

That's all folks.

neural@linuxfreak.com




